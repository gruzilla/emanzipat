!function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},i.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);class s{constructor(){this.valid=!1,this.id=null,this.data=null;let[,t,e]=window.location.href.match(s.URL_PATTERN)||[];if(void 0!==t&&void 0!==e){this.id=t;try{this.data=JSON.parse(s.b64DecodeUnicode(e))}catch(t){return console.error("https://github.com/gruzilla/emanzipat/blob/master/codes.md#silo.invalid",t),this.valid=!1,void console.debug(e)}return this.data.hasOwnProperty("d")&&this.data.hasOwnProperty("s")&&this.data.d.hasOwnProperty("l")&&this.data.d.hasOwnProperty("v")&&this.data.d.hasOwnProperty("id")?this.data.d.v<s.VERSION?(console.error("https://github.com/gruzilla/emanzipat/blob/master/codes.md#silo.version"),void(this.valid=!1)):void(this.valid=!0):(console.error("https://github.com/gruzilla/emanzipat/blob/master/codes.md#silo.invalid"),void(this.valid=!1))}this.valid=!1}static getInitializationUrl(t,e){let i=s.generateId();return console.info("https://github.com/gruzilla/emanzipat/blob/master/codes.md#initialized"),console.debug(i,t,e),"/silo/"+i+"/"+s.b64EncodeUnicode(JSON.stringify(this.wrapSettings(i,t,e)))}static getUrl(t){return console.info("https://github.com/gruzilla/emanzipat/blob/master/codes.md#updated"),"/silo/"+t.getId()+"/"+s.b64EncodeUnicode(JSON.stringify(this.wrapSettings(t.getId(),t.getName(),t.getSettings())))}static generateId(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}static b64EncodeUnicode(t){return btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode("0x"+e)}))}static b64DecodeUnicode(t){return decodeURIComponent(atob(t).split("").map(function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)}).join(""))}static wrapSettings(t,e,i){return{d:{v:s.VERSION,id:t,l:e},s:i}}isValid(){return this.valid}getId(){return this.id}getSettings(){return this.data.s}getLoaderName(){return this.data.d.l}}s.VERSION=1,s.URL_PATTERN=/\/silo\/([^/]+)\/([^/]+)/i;class o{constructor(t,e,i){this.id=t,this.settings=e,this.storage=i}render(){return'<div id="FreeTextSilo" contenteditable="true">'+this.storage.load()+"</div>"}save(){this.storage.save(document.getElementById("FreeTextSilo").innerHTML)}getId(){return this.id}getName(){return o.NAME}getSettings(){return this.settings}}o.NAME="freeText",o.DEFAULT_SETTINGS={};class n{constructor(t,e,i){this.barId=t,this.silo=e,this.storage=i,this.render()}render(){document.getElementById(this.barId).innerHTML='<div class="buttons"><button id="emanzibarNew">new</button><button id="emanzibarSave">save</button></div>',document.getElementById("emanzibarSave").addEventListener("click",this.save.bind(this)),document.getElementById("emanzibarNew").addEventListener("click",this.new.bind(this))}save(){this.silo.save(),window.location.href=s.getUrl(this.silo)}new(){window.location.href=window.location.origin}}class r{constructor(t,e){this.id=t,this.settings=e}load(){return localStorage.getItem(this.id)}isEmpty(){return null===localStorage.getItem(this.id)}save(t){localStorage.setItem(this.id,JSON.parse(JSON.stringify(t)))}}class a{constructor(t,e){this.id=t,this.settings=e}load(){return this.settings.hasOwnProperty("d")?this.settings.d:(console.error("https://github.com/gruzilla/emanzipat/blob/master/codes.md#urlStorage.noData"),"ERROR. See console.")}isEmpty(){return!this.settings.hasOwnProperty("d")||null===this.settings.d}save(t){this.settings.d=JSON.parse(JSON.stringify(t))}}class l{constructor(t,e){this.contentId=t,this.barId=e,this.silo=null,this.storage=null;let i=new s;if(i.isValid())return this.loadSilo(i.getLoaderName(),i.getId(),i.getSettings()),void(this.silo&&this.loadBar());this.showCreateSilo()}showCreateSilo(){let t=document.getElementById(this.contentId);t.innerHTML='<h1>welcome to emanzip.at</h1><p><a href="https://github.com/gruzilla/emanzipat">read me</a><p><button id="createFreeTextSilo">create new<br />Free Text Silo</button></p>',t.classList.add("init"),document.getElementById("createFreeTextSilo").addEventListener("click",function(){this.showSetupSilo("freeText")}.bind(this))}showSetupSilo(t){let e=document.getElementById(this.contentId);e.innerHTML='<h1>welcome to emanzip.at</h1><p><a href="https://github.com/gruzilla/emanzipat">read me</a><p>Great! Which <a href="https://github.com/gruzilla/emanzipat/blob/master/storage-backends.md">storage backend</a>?</p><p>Silo Type: <select id="siloType"><option value="'+t+'">Free Text Silo</option></select><br />Storage Backend: <select id="storageBackend"><option value="url">URL</option><option value="localStorage">Local Storage</option></select><br /></p><button id="createSilo">Start!</button>',e.classList.remove("init"),e.classList.add("create"),document.getElementById("createSilo").addEventListener("click",function(){l.startSilo(document.getElementById("siloType").value,document.getElementById("storageBackend").value)})}static startSilo(t,e){switch(t){case"freeText":let i=o.DEFAULT_SETTINGS;i.s=e,window.location.href=s.getInitializationUrl(o.NAME,i);break;default:console.error("Cannot create this silo, it is unkown.")}}loadSilo(t,e,i){if(this.silo=null,this.storage=null,!("s"in i))return void console.error("https://github.com/gruzilla/emanzipat/blob/master/codes.md#silo.noStorageBackend");switch(i.s){case"url":this.storage=new a(e,i);break;case"localStorage":this.storage=new r(e,i)}switch(t){case"freeText":this.storage.isEmpty()&&this.storage.save("拜托, chänge moi (:"),this.silo=new o(e,i,this.storage);break;default:console.error("Cannot load this silo, it is unkown.")}let s=document.getElementById(this.contentId);s.innerHTML=this.silo.render(),s.classList.remove("init"),s.classList.add(t),console.info("https://github.com/gruzilla/emanzipat/blob/master/codes.md#rendered")}loadBar(){new n(this.barId,this.silo,this.storage)}}new l("main","emanzibar")}]);